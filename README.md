# 📄 PDF/PPTX to Editable PPTX (AI-Enhanced)

> **基于 PaddleOCR 和 LaMa 的智能文档重构与去水印工具**

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue)](https://www.python.org/)
[![PaddleOCR](https://img.shields.io/badge/PaddleOCR-v2.7-green)](https://github.com/PaddlePaddle/PaddleOCR)
[![LaMa](https://img.shields.io/badge/AI-Inpainting-orange)](https://github.com/advimman/lama)
[![Stability](https://img.shields.io/badge/Mode-CPU%20Stable-red)]()

这是一个专为**学术科研与文档重建**场景设计的 Python 工具，能够将**图片版 PDF** 或 **不可编辑的 PPTX**（例如 NotebookLM 生成的幻灯片）转换为**真正可编辑、排版精准**的 PowerPoint 文件。

不同于传统的 OCR 工具，本项目集成了 **PaddleOCR (高精度识别)** 与 **LaMa (AI 图像修复)** 技术，不仅能提取文字，还能**自动擦除背景水印**，并采用**物理字号精算算法**，实现 1:1 的原位排版还原。

---

## ✨ 核心功能 (Key Features)

### 1. 🧪 显微镜级 OCR 识别 (Microscope OCR)
- **高感光模式**：基于 PaddleOCR 2.7 定制，极大降低检测阈值 (`thresh=0.08`)，能够识别极淡、极小的角标文字（如页码、脚注）。
- **自适应防漏页**：内置智能重试机制。如果高清模式下 OCR 视野受限导致漏页，自动降维重扫，确保不丢一页。

### 2. 🎨 AI 智能去水印 (Smart Inpainting)
- **双引擎修复**：
    - **首选**：LaMa (Large Mask Inpainting) 深度学习模型，智能补全背景。
    - **备选**：OpenCV 形态学修复（当显存不足时自动切换）。
- **强制视觉擦除 (Blind Eraser)**：针对 NotebookLM 等固定位置水印（如右下角），支持坐标级强制抹除，100% 净化画面。

### 3. 📐 1:1 原位排版 (True Layout)
- **拒绝暴力合并**：放弃传统的段落合并算法，采用“所见即所得”的绝对坐标定位。OCR 看到哪里，PPT 就在哪里。
- **物理字号精算**：
  - 基于 DPI (150/200/300) 的物理像素换算公式。
  - **字体差异化补偿**：自动区分中文（微软雅黑，系数 0.55）和英文（Arial，系数 0.50）的填充策略，避免中文显大、英文显小。
  - **垂直居中对齐**：修复了 PPT 文本框文字偏上的通病。

### 4. 🛡️ 稳健运行模式 (Stable Core)
- **CPU-Only 保护**：默认强制使用 CPU 运行 OCR 和 AI 模型，彻底解决高分辨率处理时显卡爆显存 (OOM) 的问题。
- **依赖防冲突**：严格锁定了 Pillow 和 Numpy 版本，修复了 python-pptx 生成时的常见崩溃 bug。

---

## 🛠️ 环境依赖 (Requirements)

本项目对依赖版本极其敏感，请务必严格按照以下版本安装，**否则会报错**：

* **Python**: 3.8+ (推荐使用 Anaconda)
* **核心库要求**:
    * `PaddlePaddle`: 2.6.1
    * `PaddleOCR`: 2.7.0.3
    * `Numpy`: < 2.0.0 (关键！防止 Paddle 崩溃)
    * `Pillow`: 9.5.0 (关键！防止 PPT 生成报错)

### `requirements.txt` 内容参考：
```text
paddlepaddle==2.6.1
paddleocr==2.7.0.3
torch>=2.0.0
torchvision>=0.15.0
Pillow==9.5.0
opencv-python>=4.8.0
pdf2image>=1.17.0
python-pptx>=0.6.21
simple-lama-inpainting>=0.1.0
numpy<2.0.0
shapely
scikit-image
imgaug
🚀 快速开始 (Quick Start)
第一步：环境清理与安装
建议使用 Anaconda 创建纯净环境。如果之前安装过其他版本，请务必先卸载。

Bash
# 1. 卸载可能存在的冲突库 (强烈建议执行)
pip uninstall paddlepaddle paddleocr Pillow numpy python-pptx simple-lama-inpainting -y

# 2. 使用清华源一键安装 (推荐)
pip install -r requirements.txt -i [https://pypi.tuna.tsinghua.edu.cn/simple](https://pypi.tuna.tsinghua.edu.cn/simple)
第二步：准备文件
将需要转换的文件（如 test.pdf）放入项目根目录。

确保已安装 Poppler 工具（Windows 用户需下载 Poppler 并配置环境变量，或者在代码中指定 POPPLER_PATH）。

第三步：配置与运行
打开 main.py，修改底部的配置：

Python
if __name__ == "__main__":
    input_file = "test.pdf"       # 你的输入文件名
    output_file = "final_v20.pptx" # 输出文件名
    main()
运行脚本：

Bash
python main.py
⚙️ 高级配置 (Configuration)
你可以在 main.py 顶部的配置区域调整参数以适应不同文档：

Python
# === 扫描清晰度 ===
# 150: 标准 (推荐，稳定，适合大多数文档) 
# 200: 高清 (适合极小字)
# 300: 超清 (极慢，内存占用大)
SCAN_DPI = 150 

# === 强制擦除区域 ===
# 格式: [x_start%, y_start%, x_end%, y_end%]
# 默认擦除右下角水印 (NotebookLM 风格)
FORCED_ERASE_REGIONS = [
    [0.70, 0.88, 1.0, 1.0] 
]

# === 水印关键词 ===
# OCR 识别到这些词时，会自动过滤并触发 AI 修复
WATERMARK_KEYWORDS = [
    "notebooklm", "generated by", "google", "overview", ...
]
❓ 常见问题 (FAQ)
Q: 为什么生成的 PPT 图片背景有些模糊？ A: 这是为了去除水印做的 AI 修复（羽化处理）。如果不需要去水印，可以在代码中清空 FORCED_ERASE_REGIONS 并将 WATERMARK_KEYWORDS 设为空列表。

Q: 报错 AttributeError: type object 'Image' has no attribute 'ANTIALIAS'？ A: 这是因为你安装了 Pillow 10.0+。必须降级：请执行 pip install Pillow==9.5.0。

Q: 报错 ModuleNotFoundError: No module named 'numpy.core._multiarray_umath'？ A: 这是因为 Numpy 版本过高（2.0+）。请执行 pip install "numpy<2.0.0"。

Q: 运行速度慢？ A: 为了保证几百页文档处理不崩（防爆显存），我们默认使用了 CPU 模式。虽然慢，但极其稳定，能处理超大文件。

📝 License
此项目基于开源技术构建，仅供学习交流使用。